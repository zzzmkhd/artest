<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script>
        let scene;
        let rightHand;
        let leftHand;
        let prev; //最後にBoxを置いた位置を記憶する
        //Cubeに割り当てる色の配列
        let colors = ["#0062c6", "00ab00","ffcf00","7f00ff","ffffff","ff2000","f52394","593110"];
        let index = 0; // 利用する色の番号

        window.onload = () => {
            scene = document.querySelector("a-scene");
            initRightHand();
            initLeftHand();
        };

        function initRightHand() {
            rightHand = document.getElementById("rightHand");
            let textbox = document.getElementById("textbox");
            //ピンチ開始
            rightHand.addEventListener("pinchstarted", (e) => {
                let position = e.detail.position;
                //BOX生成関数
                addBox(position);
            });
            //ピンチ終了
            rightHand.addEventListener("pinchended", (e) => {
                //色の番号を加算してあとでBoxに反映
                index++;
                index %= colors.length;
                textbox.setAttribute("value", index);
            });
            //ピンチしながら手を移動
            rightHand.addEventListener("pinchmoved", (e) => {
                let position = e.detail.position;
                let length = prev.distanceTo(position);
                //一定距離以上ならboxを置く
                if (length >= 0.02) {
                    //BOX生成
                    addBox(position);
                }

            })

        };
        function initLeftHand() {
            leftHand = document.getElementById("leftHand");
            leftHand.addEventListener("pinchstarted", (e) => {
                let els = document.querySelectorAll(".box");
                for(let i=0; i <els.length; i++){
                    els[i].parentNode.removeChild(els[i]);
                }
            })

        };
        function addBox(position) {
            let box = document.createElement("a-box");
            box.setAttribute("position", position);
            box.setAttribute("scale", "0.02 0.02 0.02");
            box.setAttribute("color", colors[index]);
            // box.setAttribute("color", "#0062c6");
            //あとで一括削除するようにクラス名えっ邸
            box.setAttribute("class", "box");
            scene.appendChild(box);
            //最後にBoxを置いたところを記憶
            prev = box.object3D.position;
        }
    </script>

</head>

<body>
    <a-scene background="color:#ececec">
        <a-box position="0 1.5 -2" scale="0.5 0.5 0.5" rotation="0 45 0" color="#4cc3d9" shadow></a-box>
        <a-entity id="leftHand" hand-tracking-controls="hand:left; modelStyle:dots;"></a-entity>
        <a-entity id="rightHand" hand-tracking-controls="hand:right; modelStyle:dots;"></a-entity>
        <a-text id="textbox" value="Hello, World!" position="0 3 -3"></a-text>
    </a-scene>
</body>

</html>